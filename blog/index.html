<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html" charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <link rel="alternate" type="application/atom+xml" title="Atom" href="http://songmu.github.io/p5-Riji/blog/atom.xml">
  <link href="//netdna.bootstrapcdn.com/bootstrap/3.0.0-rc1/css/bootstrap.min.css" rel="stylesheet">
  <link href="http://songmu.github.io/p5-Riji/blog/static/css/main.css" rel="stylesheet">
  <title>Riji tutorial</title>
</head>
<body>
  <header>
    <h1><a href="http://songmu.github.io/p5-Riji/blog/">Riji tutorial</a></h1>
  </header>
  <section>
<ul class="archives">
<li><a href="http://songmu.github.io/p5-Riji/blog/entry/001_setup.html">001. Rijiのセットアップ</a></li>
<li><a href="http://songmu.github.io/p5-Riji/blog/entry/002_edit.html">002. Blog設定と記事の作成</a></li>
<li><a href="http://songmu.github.io/p5-Riji/blog/entry/003_publish.html">003. Blogの書き出しと公開</a></li>
<li><a href="http://songmu.github.io/p5-Riji/blog/entry/004_static.html">004. 静的ファイルの配置と配信</a></li>
<li><a href="http://songmu.github.io/p5-Riji/blog/entry/005_template.html">005. テンプレートファイルの編集</a></li>
<li><a href="http://songmu.github.io/p5-Riji/blog/entry/006_header.html">006. ヘッダーセクションを利用したブログ記事へのタグやメタ情報の追加</a></li>
<li><a href="http://songmu.github.io/p5-Riji/blog/entry/007_gleaning.html">007. 落穂拾い</a></li>
</ul>

<article>
<h1>001. Rijiのセットアップ</h1>

<p>RijiはシンプルなBlogツールです。「日記」の中国語のピンイン発音表記が<span lang="zh-cn">rìjì</span>であることに由来しています。以下の様な特色があります。</p>

<ul>
<li>Markdownがサイトになる</li>
<li>gitで管理する</li>
<li>gitの情報を元にRSS(Atom)が自動的に作られる</li>
</ul>


<p>このチュートリアルもRijiを使って作られています。何はともあれまずは使ってみましょう。</p>

<h2>インストール</h2>

<p>Perl5.10以降の環境があれば以下のコマンド一発でインストールが完了します。</p>

<pre><code>% cpanm Riji
</code></pre>

<p>上記の操作を行うと、<code>riji</code>というコマンドがインストールされます。以降このコマンドを使ってBlogの操作を行います。</p>

<h2>セットアップ</h2>

<p>適当な空のディレクトリを作り、その中で以下のコマンドを実行すると雛形が作られ、gitのリポジトリ作成、コミットまで自動で行われます。</p>

<pre><code>% riji setup
</code></pre>

<p>この状態でディレクトリを見ると以下のようになっていると思います。</p>

<pre><code>% tree
.
|-- README.md
|-- article
|   |-- archives.md
|   |-- entry
|   |   `-- sample.md
|   `-- index.md
|-- riji.yml
`-- share
    `-- tmpl
            |-- base.tx
            |-- default.tx
            |-- entry.tx
            |-- index.tx
            `-- tag.tx
</code></pre>

<h2>ディレクトリ構成</h2>

<h3>riji.yml</h3>

<p>設定ファイルです</p>

<h3>article/</h3>

<p>コンテンツ用のmdファイルを配置します。mdファイルを作るとそれに対応したURLでアクセス可能になります。</p>

<p>article直下のmdファイルはデフォルトで share/tmpl/default.tx がテンプレートに使われます。indexのみ例外でindex.txがテンプレートで使われるようになっています。</p>

<h3>article/entry/</h3>

<p>ブログエントリーのmdファイルを配置するディレクトリです。デフォルトでentry.txがテンプレートに使われます。</p>

<h3>share/tmpl/</h3>

<p>テンプレートが配置されています。Text::Xslate形式です</p>

<h3>share/static/</h3>

<p>静的ファイルを配置します。static/... でアクセス可能になります。</p>

<h2>起動</h2>

<p>何はともあれこの状態で一旦サーバーを起動してみましょう。Rijiには組込のサーバーが付属しており簡単に動作確認可能です。</p>

<pre><code>% riji server
HTTP::Server::PSGI: Accepting connections at http://0:3650/
</code></pre>

<p>3650番ポートでサーバーが起動するので、http://localhost:3650 にアクセスしてみてください。以下の様に表示されればOKです。</p>

<p><img src="http://songmu.github.io/p5-Riji/blog/static/001setup.png" alt="setup" /></p>

<h2>riji setup --force</h2>

<p>空じゃない既存のディレクトリに<code>riji setup</code>したい場合は<code>% riji setup --force</code>を指定して下さい。GitHub Pagesを使うときなどに便利です。</p>

<p>今回はここまでです。</p>

<h2>次回の内容</h2>

<p>次回は新たにblogの設定と記事の作成を行います。</p>

<p><a href="http://songmu.github.io/p5-Riji/blog/entry/002_edit.html">002. Blog設定と記事の作成</a></p>

</article>
<article>
<h1>002. Blog設定と記事の作成</h1>

<p>さて、前回はRijiのセットアップを行いました。<code>riji</code>というコマンドを使ってBlogを操作することを覚えているかと思います。また前回作ったリポジトリが手元にあると思うので引き続き、Rijiを使っていきましょう。</p>

<h2>Blogの設定</h2>

<p>リポジトリにはriji.ymlが作られていますが、これの中身は以下のようになっています。</p>

<pre><code>author:   'Your name'
title:    "Your Blog Title"
site_url: 'http://yourblog.example.com/'
</code></pre>

<p>完全に仮の初期設定なので、自分の環境にあわせて変更してみましょう。<code>site_url</code>は最終的にアップするサイトのURLに合わせてください。特に決まってないのであれば仮のままで大丈夫です。</p>

<p>変更した状態で<code>% riji server</code>を起動してBlogを確認してみて下さい。変更内容が反映されているでしょうか？反映されていればriji.ymlをコミットしましょう。これでBlogの設定は完了です。</p>

<p>余談ですが、設定ファイルはTOMLにしようかとも考えたのですが、日和ってYAMLにしました。今後TOMLに対応するかもしれません。</p>

<h2>Blog記事の作成</h2>

<p>早速記事を作成してみましょう。…と言いたいところですが、まずはsampleのファイルは必要ないので消してしまいましょう。</p>

<pre><code>% git rm article/entry/sample.md
% git commit -m "remove sample.md"
</code></pre>

<p>次に、記事を作成しましょう。article/entry/ 以下に配置されていて拡張子が.mdになっていればなんでも良いのですが、今回はstart.mdという名前にして編集してみましょう。</p>

<pre><code>% $EDITOR article/entry/start.md
% cat article/entry/start.md
# blog開設

Rijiを使ってBlogを開設しました。
</code></pre>

<p>編集はMarkdown形式でおこないます。<a href="http://www.pell.portland.or.us/~orc/Code/discount/">Discount</a>というMarkdownパーサーがデフォルトで使われます。github flavored markdownと比較的互換があると思います。</p>

<p>さて、編集を終えたら、例に因って記事をコミットしてください。それから<code>riji server</code>をたちあげて、http://localhost:3650/entry/start.html にアクセスしてみましょう。以下の様な画面が表示されていればOKです。</p>

<p><img src="http://songmu.github.io/p5-Riji/blog/static/002edit.png" alt="edit" /></p>

<h2>Blog記事の追加</h2>

<p>さて、もう一つ記事を追加してみましょう。ただ、毎回.mdファイルの名前を考えるのは面倒です。そこで以下のコマンドを使いましょう。</p>

<pre><code>% riji new-entry
</code></pre>

<p>今日の日付をもとに、エントリーファイルが作られ、環境変数<code>$EDITOR</code>が正しく設定されて入ればエディタも起動します。それを適宜編集して保存してコミットしましょう。これで２つ目のエントリーが作られました。<code>riji server</code>を使って確認してみてください。</p>

<h2>Blog記事以外のコンテンツの追加</h2>

<p>Blog記事ではないコンテンツをサイトに追加したい時もあるでしょう。例えば自身のプロフィールページなどです。</p>

<p>そういったコンテンツは article/ 直下に配置します。プロフィールであれば、article/profile.md と言った具合になるでしょうか。この場合だと、article/profile.htmlにアクセスするとプロフィールページを閲覧できるようになるはずです。</p>

<p>今回はここまでです。</p>

<h2>次回の内容</h2>

<p>これまでは<code>riji server</code>を使った手元での確認だけでしたが、次回は実際にBlogの書き出しを行います。</p>

<p><a href="http://songmu.github.io/p5-Riji/blog/entry/003_publish.html">003. Blogの書き出しと公開</a></p>

</article>
<article>
<h1>003. Blogの書き出しと公開</h1>

<p>Rijiは<code>riji server</code>で動的に運用してもいいのですが、静的配信にも対応しています。静的配信できた方が何かと便利ですね。</p>

<p>前回勿体つけて「Blogの書き出し」などといいましたが、Blogの書き出しは実に簡単で以下のコマンドを実行するだけです。</p>

<pre><code>% riji publish
</code></pre>

<p>上手く行けばblog/というディレクトリが作られ、その中にサイト一式が格納されているはずです。atom.xmlも入っていますね。</p>

<p>もしかしたら、wgetが無いことを怒られるかもしれません。その場合はwgetをインストールしてください。なんでwgetを使ってるかは実装を見て察してください。</p>

<p>あとは、blog/ディレクトリをどこかにアップロードするだけです。せっかくgitリポジトリになっているので、そのままGitHub Pages等にpushしてしまっても良いんじゃないかと思います。</p>

<h2>publishディレクトリの変更</h2>

<p>上のようにデフォルトでは blog/ にサイトが作られますが、これを変更したいという要望もあるかと思います。その場合は、riji.ymlにpublish_dirというキーを追加して設定を書いてください。'.' に設定したらカレントディレクトリにドバっと作られます。</p>

<h2>GitHub Pagesについて</h2>

<p>githubで"[username].github.io"というリポジトリを作成するとそれを自分のサイトとして運用することが可能になります。git pushすればすぐにサイトに反映されるので非常に楽ちんです。Rijiで作成したblogの配信先として検討しても良いと思います。</p>

<h2>Githubリポジトリへのページ設置について</h2>

<p>[username].github.ioに関してはよく知られるところですが、自分のリポジトリで<code>gh-pages</code>というブランチを作るとそれもGitHub Pagesとして運用可能であることはご存知でしょうか？これで作られたサイトは http://[username].github.io/[repositoryname]/ というURLでアクセスが可能になります。</p>

<p>具体的には以下の手順で作成します。</p>

<dl>
<dt>親のないブランチを作成</dt>
<dd><code>% git checkout --orphan gh-pages</code></dd>
<dt>ファイルを全て削除</dt>
<dd><code>% git rm -rf *</code></dd>
<dt>空じゃないディレクトリにセットアップするので--forceをつけてriji setup</dt>
<dd><code>% riji setup --force</code></dd>
<dt>追随するブランチがmasterブランチではないので、riji.ymlに追随ブランチの設定をする</dt>
<dd><code>% echo 'branch: gh-pages' &gt;&gt; riji.yml</code></dd>
<dt>pushする</dt>
<dd><code>% git push --set-upstream origin gh-pages</code></dd>
</dl>

<p>あとはこれまで学んできたようにRijiを運用するだけです。</p>

<p>今回はここまでです。</p>

<h2>次回の内容</h2>

<p>とりあえず、公開するところまではできましたが、簡素でバランスの悪いデフォルトのデザインの調整等がしたくなってきている頃かと思います。
次回は、静的ファイルの配信について説明します。</p>

<p><a href="http://songmu.github.io/p5-Riji/blog/entry/004_static.html">004. 静的ファイルの配置と配信</a></p>

</article>
<article>
<h1>004. 静的ファイルの配置と配信</h1>

<p>サイトは公開したものの、デフォルトのイケてないデザインを画像やCSSを使って調整したいと思うでしょう。今回は静的ファイルの配置について説明します。</p>

<h2>配置ディレクトリ</h2>

<p>静的ファイルは share/static ディレクトリ以下に配置するルールになっています。そこに配置したファイルは /static/image.jpg と言ったURLでアクセス可能となります。share/static/img, share/static/css, share/static/jsなどとディレクトリを掘るのがお行儀が良いかも知れません。</p>

<p>配置した画像は以下のようにすれば、Blogエントリーから参照可能です。</p>

<pre><code>![画像](&lt;: '/static/hoge.png' | uri_for :&gt;)
</code></pre>

<p>なんとテンプレートに使われているXslateの記法をmdファイル内でも使えるのが無理矢理なおしゃれポイントです。<code>uri_for</code>を使う必要は必ずしもありませんが、ディレクトリの深さが異なる環境で動かした場合にリンクが切れたりする可能性があるので、なるべく丁寧に指定したほうが良いでしょう。</p>

<h2>デフォルトテンプレートで使われているCSS, JSについて</h2>

<p>デフォルトのテンプレートでは以下のライブラリが使われています。</p>

<ul>
<li>jQuery</li>
<li>Google Code Prettify</li>
<li>Boogstrap</li>
</ul>


<p>色々めんどくさいので同梱はせずに外部リソースに直接向ける形になっています。パーソナルユースだったら十分かなと思います。BootstrapのCDNは公式じゃなかったりして若干不安もありますが、気になるようでしたら自分で適宜テンプレートを調整して下さい。</p>

<h2>favicon.ico</h2>

<p>ちょっとした例外として、favicon.icoはtmpl/static/favicon.ico に配置すれば<code>'/favicon.ico' | uri_for</code>で参照できるようになっています。</p>

<p>今回はここまでです。</p>

<h2>次回の内容</h2>

<p>静的ファイルを配置したら、今度はhtmlを編集したくなってくるでしょう。次回はテンプレートの編集について説明します。</p>

<p><a href="http://songmu.github.io/p5-Riji/blog/entry/005_template.html">005. テンプレートファイルの編集</a></p>

</article>
<article>
<h1>005. テンプレートファイルの編集</h1>

<p>前回、静的ファイルを配置する方法について説明しましたが、今回はいよいよテンプレートファイルの編集を行います。これでひと通りRijiの基本機能をマスターして、自分のBlogサイトを構築できるようになるでしょう。</p>

<h2>テンプレートディレクトリ</h2>

<p>テンプレートはshare/tmplに配置します。初期状態では以下のようになっています。</p>

<pre><code>% tree share/tmpl
share/tmpl
├── base.tx
├── default.tx
├── entry.tx
├── index.tx
└── tag.tx
</code></pre>

<p>テンプレートにはPerlの高速テンプレートエンジンである<a href="http://xslate.org/">Xslate</a>を採用しており、拡張子は.txとなっています。Xslateにはいくつかシンタックスがあるのですが、Rijiでは標準のシンタックスである"Kolon"を利用しています。</p>

<h2>Kolonのシンタックスについて</h2>

<p>詳しくは<a href="http://xslate.org/">公式ページ</a>から辿れるドキュメント等に説明を譲りますが、KolonはPerl6ライクな文法を提供するテンプレートエンジンになっています。各変数の頭には<code>$</code>がついています。一度代入した変数には最大入不可能であることに注意して下さい。以下のようにすることで変数の中見を描画することができます。</p>

<pre><code>&lt;: $bar :&gt;
</code></pre>

<p>Rijiではテンプレート描画時にテンプレートに自動的にいくつかの変数が渡されます。</p>

<h2>初期テンプレートの役割について</h2>

<h3>base.tx</h3>

<p>ベースのテンプレートです。Xslateにはテンプレート継承という概念があり、base.txはすべての継承元のテンプレートとして使うことが想定されています。もちろんそれに強制的に従う必要はありません。</p>

<p>すべてのページには変数<code>$blog</code>が渡されますが、このページでもその変数を使うことができます。</p>

<h3>default.tx</h3>

<p>標準のテンプレートです。article直下のmdファイルに対応するコンテンツを描画するのに利用されます。<code>riji setup</code>でarticle/archives.md というファイルが作られて、archives.html というアドレスでアクセス可能になっているかと思いますが、それはこのテンプレートを使って描画されています。</p>

<p><code>$blog</code>の他に<code>$article</code>という変数が渡されます。</p>

<h3>entry.tx</h3>

<p>ブログエントリー描画用のテンプレートです。中見を見るとわかると思いますが、標準で前後のエントリーへのリンクなどが記述されていることが分かるでしょう。</p>

<p><code>$blog</code>の他に<code>$entry</code>という変数が渡されます。</p>

<h3>index.tx</h3>

<p>ブログの全体トップページ用のテンプレートです。</p>

<p><code>$blog</code>の他に<code>$article</code>という変数が渡されます。</p>

<h3>tag.tx</h3>

<p>タグページ用のテンプレートです。タグとは何でしょうか？</p>

<p>実はRijiではBlogエントリにタグを付けることができるのですが、今回はそれには触れません。</p>

<p><code>$blog</code>の他に<code>$tag</code>という変数が渡されます。</p>

<h2>変数について</h2>

<p>自動的に渡されるそれぞれの変数には様々なプロパティやメソッドがぶら下がっています。どんなプロパティやメソッドがあるかはここでは細かくは触れませんが、初期テンプレートの中見を見て参考にしてみて下さい。余力があればRiji本体のソースコードを読んでみて下さい。</p>

<h2>mdファイル内でのXslate記述について</h2>

<p>MarkdownはHTMLを直接記載可能なマークアップ書式であり、かつ、mdファイルの中でXslateの記法も使えることは前回説明したとおりなので、結構複雑なテンプレートをmdファイルの上に書くことも可能です。あまりオススメはしません。</p>

<p>今回はここまでです。</p>

<h2>次回の内容</h2>

<p>テンプレートの編集まで終わり、ひと通りサイトを編集できるようになったと思います。次回はブログ記事にメタ情報を付加する方法について説明します。今回触れられなかったタグについても取り上げます。</p>

<p><a href="http://songmu.github.io/p5-Riji/blog/entry/006_header.html">006. ヘッダーセクションを利用したブログ記事へのタグやメタ情報の追加</a></p>

</article>
<article>
<h1>006. ヘッダーセクションを利用したブログ記事へのタグやメタ情報の追加</h1>

<h2>ヘッダーセクション</h2>

<p>各Blogエントリーのmdファイルの先頭にYAML形式でヘッダーセクションを記述でき、記事に関するメタ情報を記載することができます。</p>

<p>ヘッダーセクションと本文は'---'で区切られます。以下のように記述します。</p>

<pre><code>tags: tag1 tag2
template: entry2
title: title
pubdate: 2013-07-21
paginate: ~
---
# 本文開始
...
</code></pre>

<p>ヘッダーセクションは任意記述で、記述する場合もきつような項目のみで、すべての項目を記載する必要はありません。各項目の内容は以下のとおりです。</p>

<h3>tags</h3>

<p>記事にタグを設定出来ます。カンマ区切りかスペース区切り、もしくは配列で指定可能です。</p>

<h3>template</h3>

<p>ブログ記事の場合entry.tx、それ以外のarticle/直下のページはdefault.txがデフォルトで使われますが、それ以外のものを使いたい場合に記載します。拡張子は省略して指定します。</p>

<h3>title</h3>

<p>タイトルを指定します。タイトルを指定しない場合、本文中に最初に現れるヘッダ行がタイトルとして使われます。基本的には使用しなくてよいでしょう。</p>

<h3>pubdate</h3>

<p>公開時間を指定します。gitから自動的に情報が取得されるためあまり明示的に指定する必要はないでしょう。公開時間まで隠しておくとかそういうことも残念がらできません。</p>

<h3>paginate</h3>

<p>ページングするかどうかのフラグを設定出来ます。デフォルトfalseです。ページングに関してはまだ仕様が未確定です。</p>

<h2>タグについて</h2>

<p>タグが指定されたページが作られると、/tag/tagname.html というページにアクセスできるようになり、そのタグが付いた記事を一覧することができるようになります。ブログで使われているタグ一覧は、テンプレート変数である<code>$blog.tags()</code>でアクセス可能になっています。</p>

<p>今回はここまでです。</p>

<h2>次回の内容</h2>

<p>もうRiji全ての機能は説明したといっても良いでしょう。次回は本チュートリアルの最終回です。</p>

<p><a href="http://songmu.github.io/p5-Riji/blog/entry/007_gleaning.html">007. 落穂広い</a></p>

</article>
<article>
<h1>007. 落穂拾い</h1>

<h2>下書きの管理はどうすればよいか？</h2>

<p>Rijiでは追随ブランチ(デフォルトではmaster)にコミットした記事は否応なしに公開されます。では公開したくない下書きの管理はどうすれば良いのでしょうか？</p>

<p>書き上がるまではコミットしないで手元に保存しておく？それはあまりスマートではありません。せっかくgitを使っているのですから、下書き用のブランチ(例えばdraft)を作り、そちらにコミットしておけばよいのです。書き上がったら、そっちのブランチから追随ブランチへcheckoutしてくれば良いでしょう。</p>

<h2>コメント機能について</h2>

<p>Rijiではコメント機能を用意しておりません。DisqusのようなAjaxベースのコメント機能を利用するのが良いでしょう。</p>

<h2>検索窓に関して</h2>

<p>Googleのサイト内検索を使えば良いと思います</p>

<h2>動的配信について</h2>

<p>静的配信はめんどくさいから動的配信したいという人もいるかと思います。その場合は、自分のサーバーにリポジトリをpullして、<code>riji server</code>を直接動かしても良いでしょう。実は<code>riji server</code>は<code>plackup</code>と同じ引数を受け取ることができるので、<code>riji server -s Starman -p 9999</code>などと指定することも可能になっています。</p>

<p>注意点としては、コンテンツを追加しても、プロセスの再起動をしないと変更が反映されない部分があるということです。</p>

<p>コミットフック等を利用してサーバーがgraceful restartできるようになっていたりすると美しいですね。その辺り、うまい運用のやり方を編み出して作者に教えてもらえると嬉しいです。</p>

<h2>トラックバックに関して</h2>

<p>残念ながらトラックバックはオワコンになりました。概念としては個人的に好きだったのですが、多くの人に誤った理解をされ誤った使い方をされた挙句廃れてしまったのは非常に残念に思っています。Rijiにはトラックバック機能はありません。</p>

<h2>その他機能追加要望に関して</h2>

<p>使っているうちにXslateに関数を追加したい、プラグイン機構を入れたい、等色々要望は出てくるかと思います。</p>

<p>開発は以下で行なっているので随時pull requestやissueを投げていただけると非常に嬉しいです。</p>

<p><a href="https://github.com/Songmu/p5-Riji">https://github.com/Songmu/p5-Riji</a></p>

<h2>終わりに</h2>

<p>もし、ここまで読んでいただけた方がいると大変嬉しいです。ぜひRijiを使ってみてください。フィードバックをいただけると作者は泣いて喜びます。</p>

</article>

  </section>
  <footer>
  </footer>

  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
  <script src="//netdna.bootstrapcdn.com/bootstrap/3.0.0-rc1/js/bootstrap.min.js"></script>
  <script src="//google-code-prettify.googlecode.com/svn/loader/run_prettify.js"></script>
  <script>$(function(){$('pre > code').addClass('prettyprint');});</script>
</body>
</html>
